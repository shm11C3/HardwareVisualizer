name: "Setup Rust Environment"
description: "Setup Rust toolchain with caching and components"
inputs:
  components:
    description: "Additional components to install"
    required: false
    default: "rustfmt clippy"
  targets:
    description: "Additional targets to install"
    required: false
    default: ""

runs:
  using: "composite"
  steps:
    - uses: dtolnay/rust-toolchain@6d9817901c499d6b02debbb57edb38d33daa680b # stable
      with:
        targets: ${{ inputs.targets }}

    - uses: Swatinem/rust-cache@779680da715d629ac1d338a641029a2f4372abb5 # v2.8.2
      with:
        workspaces: "./src-tauri -> target"
        add-job-id-key: "false"
        shared-key: "src-tauri"
        save-if: ${{ github.ref == format('refs/heads/{0}', github.event.repository.default_branch) }}

    - name: Install Rust components
      if: inputs.components != ''
      run: rustup component add ${{ inputs.components }}
      shell: bash
