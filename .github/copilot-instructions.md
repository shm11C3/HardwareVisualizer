# HardwareVisualizer – Copilot Coding Agent Instructions

## Big picture
- Cross-platform hardware monitoring app (React/Vite + Tauri/Rust).
- Frontend ↔ backend calls go through **Tauri commands**. `src/rspc/bindings.ts` is **generated by tauri-specta** (do not edit).
- Rust backend follows strict one-way dependencies: **Commands → Services → Platform (Factory) → OS APIs** (see `docs/ARCHITECTURE/BACKEND_ARCHITECTURE.md`).

## Where to change code
- UI/features: `src/features/**` (e.g. `src/features/settings/hooks/useSettingsAtom.ts`). Shared UI lives in `src/components/ui/**` (shadcn/Radix).
- State management uses **Jotai**: define with `atom(...)`, consume with `useAtom(...)` (e.g. `src/features/hardware/hooks/useHardwareInfoAtom.ts`).
- Lightweight persisted UI settings: Tauri Store plugin.
  - Store instance: `src/lib/tauriStore.ts`
  - Hook: `src/hooks/useTauriStore.ts` (returns a union of `[value|null, setValue, isPending]`)

## Backend/Frontend integration
- Call commands via `import { commands } from "@/rspc/bindings"`.
- Check `Result` with `isError(...)` (e.g. `src/features/hardware/hooks/useHardwareInfoAtom.ts`). On failure, notify via `useTauriDialog().error(...)`.
- When adding a new backend command:
  - Add code in `src-tauri/src/commands/*.rs` (UI boundary) → `src-tauri/src/services/*.rs` (business logic) → `src-tauri/src/platform/**` (OS-specific)
  - If OS APIs / DB / external I/O are involved, also add/change `src-tauri/src/infrastructure/**` (e.g. `infrastructure/providers/**`, `infrastructure/database/**`)
  - Register it in `collect_commands![ ... ]` inside `src-tauri/src/lib.rs` (this drives TS bindings generation)
  - `src/rspc/bindings.ts` is exported from `src-tauri/src/lib.rs` in debug builds; regenerate via `npm run tauri dev`

## Error/event conventions
- Backend emits `error_event`; frontend shows a modal via `useErrorModalListener` (see `src/hooks/useTauriEventListener.ts`).

## Dev workflows (repo-specific)
- Prereqs: Node.js v24 (per README) + Rust (toolchain in `rust-toolchain.toml`).
- Linux build deps: `libwebkit2gtk-4.1-dev libappindicator3-dev librsvg2-dev patchelf` (see CI/README). Some metrics require sudo.
- Web UI only: `npm run dev` (React DevTools + Vite). Vite port is fixed to `1520` (`vite.config.ts`).
- Desktop (Tauri): `npm run tauri dev`
- Frontend lint/format: `npm run lint` / `npm run format` (Biome; primarily targets `./src`)
- Frontend tests: `npm test` (Vitest; config in `vitest.config.ts` / setup in `src/test/setup.ts`)
- Rust checks (CI parity):
  - `cargo tauri-fmt`
  - `cargo tauri-lint`
  - `cargo tauri-test`

## Project conventions
- Import alias: `@` → `src` (`vite.config.ts` / `vitest.config.ts`).
- i18n: `src/lib/i18n.ts` with `src/lang/en.json` and `src/lang/ja.json`. Add UI strings to JSON and reference via `useTranslation()` (e.g. `src/App.tsx`).
- Avoid editing generated/vendor outputs: do not edit `src/rspc/bindings.ts`.

## Communication
- Write code comments and git commit messages in English.
- In chat, match the language used in the user prompt.
